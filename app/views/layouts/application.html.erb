<!DOCTYPE html>
<html>
  <head>
    <title>Hangout</title>
    <%= csrf_meta_tags %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body data-active-haunt=<%= current_haunt.try(:id) %> >
    <div id="wrapper">
      <main>
        <div id="content">
          <div class="innertube">
            <ul>
              <% if haunt_signed_in? %>
                <li>
                  <%= link_to('Logout', destroy_haunt_session_path, :method => :delete) %>
                </li>
              <% else %>
                <li>
                  <%= link_to('Login', new_haunt_session_path)  %>
                </li>
              <% end %>
            </ul>
            <p class="notice"><%= notice %></p>
            <p class="alert"><%= alert %></p>

            <%= yield %>
          </div>
        </div>
      </main>

      <nav id="nav">
        <div class="innertube">
          <h3>Online</h3>
          <div id="appearances">
            <ul>
              <% @appearances.each do |haunt| %>
                <%= render partial: "haunts/online", locals: {haunt: haunt, appearences_ids: $redis_onlines.keys.collect(&:to_i)} %>
              <% end %>
            </ul>
          </div>
        </div>
      </nav>
    </div>

    <audio id="chatAudio"><source src="<%= asset_path '/assets/notification.mp3' %>" type="audio/mpeg"></audio>
    <audio id="sendAudio"><source src="<%= asset_path '/assets/send.mp3' %>" type="audio/mpeg"></audio>
  </body>
</html>
